@model IEnumerable<NabdAltamayyuz.Models.Company>
@using System.Globalization

@{
    ViewData["Title"] = "لوحة القيادة العليا";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var isRtl = CultureInfo.CurrentCulture.Name.StartsWith("ar");
    var companiesCount = ViewBag.CompaniesCount ?? 0;
    var employeesCount = ViewBag.EmployeesCount ?? 0;
}

<div class="container py-5 animate-fade-in" style="margin-top: 100px;">
    <!-- Welcome Header -->
    <div class="row mb-5 align-items-end">
        <div class="col-lg-8">
            <h6 class="text-gold text-uppercase fw-bold letter-spacing-1 mb-2">@(isRtl ? "نظرة عامة على النظام" : "System Overview")</h6>
            <h2 class="fw-bold text-dark display-5">
                @(isRtl ? "مرحباً،" : "Hello,") <span class="text-primary-gradient">@(isRtl ? "المالك" : "Super Admin")</span>
            </h2>
            <p class="text-muted mb-0">@(isRtl ? "إليك ملخص أداء الشركات والموظفين لهذا الشهر." : "Here's the performance summary for companies and employees this month.")</p>
        </div>
        <div class="col-lg-4 text-lg-end mt-4 mt-lg-0">
            <div class="d-flex gap-2 justify-content-lg-end">
                <button class="btn btn-outline-dark rounded-pill px-4" onclick="window.print()">
                    <i class="fas fa-download me-2"></i> @(isRtl ? "تصدير تقرير" : "Export Report")
                </button>
                <button class="btn btn-gold bg-dark text-gold fw-bold shadow-lg rounded-pill px-4 hover-scale" data-bs-toggle="modal" data-bs-target="#addCompanyModal">
                    <i class="fas fa-plus-circle me-2"></i> @(isRtl ? "إضافة شركة" : "Add Company")
                </button>
            </div>
        </div>
    </div>

    <!-- Analytics Cards -->
    <div class="row g-4 mb-5">
        <!-- Companies Stat -->
        <div class="col-md-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100 rounded-4 overflow-hidden position-relative bg-white">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="icon-box bg-primary bg-opacity-10 text-primary rounded-circle p-3">
                            <i class="fas fa-building fa-lg"></i>
                        </div>
                        <span class="badge bg-success bg-opacity-10 text-success rounded-pill px-3 py-1">+12%</span>
                    </div>
                    <h3 class="fw-bold mb-1">@companiesCount</h3>
                    <p class="text-muted small mb-0">@(isRtl ? "إجمالي الشركات المسجلة" : "Total Registered Companies")</p>
                </div>
                <div class="progress h-1 mt-auto mx-4 mb-4 rounded-pill" style="background-color: #e9ecef;">
                    <div class="progress-bar bg-primary" role="progressbar" style="width: 75%"></div>
                </div>
            </div>
        </div>

        <!-- Employees Stat -->
        <div class="col-md-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100 rounded-4 overflow-hidden position-relative bg-white">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="icon-box bg-warning bg-opacity-10 text-warning rounded-circle p-3">
                            <i class="fas fa-users fa-lg"></i>
                        </div>
                        <span class="badge bg-success bg-opacity-10 text-success rounded-pill px-3 py-1">+5%</span>
                    </div>
                    <h3 class="fw-bold mb-1">@employeesCount</h3>
                    <p class="text-muted small mb-0">@(isRtl ? "إجمالي الموظفين بالنظام" : "Total Active Employees")</p>
                </div>
                <div class="progress h-1 mt-auto mx-4 mb-4 rounded-pill" style="background-color: #e9ecef;">
                    <div class="progress-bar bg-warning" role="progressbar" style="width: 60%"></div>
                </div>
            </div>
        </div>

        <!-- Active Tasks (Mocked for overview) -->
        <div class="col-md-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100 rounded-4 overflow-hidden position-relative bg-white">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="icon-box bg-danger bg-opacity-10 text-danger rounded-circle p-3">
                            <i class="fas fa-tasks fa-lg"></i>
                        </div>
                        <span class="badge bg-danger bg-opacity-10 text-danger rounded-pill px-3 py-1">@(isRtl ? "نشط" : "Active")</span>
                    </div>
                    <h3 class="fw-bold mb-1">24</h3>
                    <p class="text-muted small mb-0">@(isRtl ? "عمليات إدارية جارية" : "Ongoing Admin Operations")</p>
                </div>
                <div class="progress h-1 mt-auto mx-4 mb-4 rounded-pill" style="background-color: #e9ecef;">
                    <div class="progress-bar bg-danger" role="progressbar" style="width: 45%"></div>
                </div>
            </div>
        </div>

        <!-- Revenue/Performance (Mocked) -->
        <div class="col-md-6 col-xl-3">
            <div class="card border-0 shadow-sm h-100 rounded-4 overflow-hidden position-relative bg-dark text-white">
                <div class="position-absolute top-0 end-0 p-4 opacity-10">
                    <i class="fas fa-chart-line fa-4x"></i>
                </div>
                <div class="card-body p-4 position-relative z-1">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="icon-box bg-gold bg-opacity-25 text-gold rounded-circle p-3">
                            <i class="fas fa-gem fa-lg"></i>
                        </div>
                    </div>
                    <h3 class="fw-bold mb-1 text-gold">98.5%</h3>
                    <p class="text-white-50 small mb-0">@(isRtl ? "معدل رضا العملاء" : "Client Satisfaction Rate")</p>
                </div>
                <div class="progress h-1 mt-auto mx-4 mb-4 rounded-pill bg-secondary bg-opacity-25">
                    <div class="progress-bar bg-gold" role="progressbar" style="width: 98%"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Main Content: Companies List -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden h-100">
                <div class="card-header bg-white py-4 px-4 border-bottom d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="fw-bold mb-0 text-dark">@(isRtl ? "الشركات وإدارة الاشتراكات" : "Companies & Subscriptions")</h5>
                        <small class="text-muted">@(isRtl ? "إدارة الشركات المسجلة وصلاحياتها" : "Manage registered companies and access")</small>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-light btn-sm rounded-circle shadow-sm" type="button" data-bs-toggle="dropdown">
                            <i class="fas fa-ellipsis-h text-muted"></i>
                        </button>
                        <ul class="dropdown-menu border-0 shadow-lg">
                            <li><a class="dropdown-item" href="#"><i class="fas fa-sort-alpha-down me-2"></i> @(isRtl ? "فرز حسب الاسم" : "Sort by Name")</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-calendar me-2"></i> @(isRtl ? "فرز حسب التاريخ" : "Sort by Date")</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light text-secondary small text-uppercase">
                                <tr>
                                    <th class="py-3 px-4">@(isRtl ? "الشركة" : "Company")</th>
                                    <th>@(isRtl ? "معلومات الاتصال" : "Contact Info")</th>
                                    <th>@(isRtl ? "تاريخ التسجيل" : "Joined Date")</th>
                                    <th>@(isRtl ? "الحالة" : "Status")</th>
                                    <th class="text-end px-4">@(isRtl ? "إجراءات" : "Actions")</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model != null && Model.Any())
                                {
                                    foreach (var item in Model)
                                    {
                                        <tr>
                                            <td class="px-4">
                                                <div class="d-flex align-items-center">
                                                    <div class="avatar-circle bg-dark text-gold rounded-3 d-flex align-items-center justify-content-center me-3" style="width: 45px; height: 45px;">
                                                        <i class="fas fa-building"></i>
                                                    </div>
                                                    <div>
                                                        <div class="fw-bold text-dark">@item.Name</div>
                                                        <small class="text-muted font-monospace">@item.RegistrationNumber</small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="d-flex flex-column">
                                                    <small class="text-dark"><i class="fas fa-user-tie me-1 text-gold"></i> المدير العام</small>
                                                    <small class="text-muted">manager@company.com</small>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="badge bg-light text-dark border">
                                                    @item.CreatedAt.ToString("yyyy-MM-dd")
                                                </div>
                                            </td>
                                            <td><span class="badge bg-success bg-opacity-10 text-success rounded-pill px-3 py-2">@(isRtl ? "نشط" : "Active")</span></td>
                                            <td class="text-end px-4">
                                                <div class="d-flex justify-content-end gap-2">
                                                    <a href="/Companies/Edit/@item.Id" class="btn btn-sm btn-outline-primary rounded-pill px-3" data-bs-toggle="tooltip" title="@(isRtl ? "تعديل البيانات" : "Edit Details")">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    <a href="/Employees/Index" class="btn btn-sm btn-outline-info rounded-pill px-3" data-bs-toggle="tooltip" title="@(isRtl ? "عرض الموظفين" : "View Employees")">
                                                        <i class="fas fa-users"></i>
                                                    </a>
                                                    <a href="/Companies/Delete/@item.Id" class="btn btn-sm btn-outline-danger rounded-pill px-3" onclick="return confirm('@(isRtl ? "حذف الشركة؟ هذا الإجراء لا يمكن التراجع عنه." : "Delete Company? This cannot be undone.")')">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="5" class="text-center py-5">
                                            <div class="text-muted opacity-50 mb-3"><i class="fas fa-folder-open fa-3x"></i></div>
                                            <p class="mb-0">@(isRtl ? "لا توجد شركات مسجلة حتى الآن" : "No companies registered yet")</p>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-white py-3 border-top d-flex justify-content-center">
                    <a href="#" class="btn btn-link text-muted text-decoration-none small">@(isRtl ? "عرض كل السجلات" : "View All Records") <i class="fas fa-angle-down ms-1"></i></a>
                </div>
            </div>
        </div>

        <!-- Sidebar: Quick Reports & Employee Distribution -->
        <div class="col-lg-4">
            <!-- Employee Distribution (Visual Mock) -->
            <div class="card border-0 shadow-lg rounded-4 mb-4">
                <div class="card-header bg-white py-3 border-bottom">
                    <h6 class="mb-0 fw-bold"><i class="fas fa-chart-pie text-gold me-2"></i> @(isRtl ? "توزيع الموظفين" : "Employee Distribution")</h6>
                </div>
                <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between mb-1">
                                <small class="fw-bold">شركة المقاولات</small>
                                <small class="text-muted">45%</small>
                            </div>
                            <div class="progress h-1 rounded-pill">
                                <div class="progress-bar bg-dark" style="width: 45%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex align-items-center mb-3">
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between mb-1">
                                <small class="fw-bold">قسم الخدمات</small>
                                <small class="text-muted">30%</small>
                            </div>
                            <div class="progress h-1 rounded-pill">
                                <div class="progress-bar bg-gold" style="width: 30%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between mb-1">
                                <small class="fw-bold">الإدارة العامة</small>
                                <small class="text-muted">25%</small>
                            </div>
                            <div class="progress h-1 rounded-pill">
                                <div class="progress-bar bg-secondary" style="width: 25%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Alerts / Logs -->
            <div class="card border-0 shadow-lg rounded-4 bg-light">
                <div class="card-header bg-transparent py-3 border-bottom d-flex justify-content-between">
                    <h6 class="mb-0 fw-bold text-dark"><i class="fas fa-bell text-warning me-2"></i> @(isRtl ? "تنبيهات النظام" : "System Alerts")</h6>
                    <span class="badge bg-danger rounded-pill">3</span>
                </div>
                <div class="list-group list-group-flush rounded-bottom">
                    <a href="#" class="list-group-item list-group-item-action bg-transparent py-3 border-bottom">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1 fw-bold text-dark small"><i class="fas fa-exclamation-circle text-danger me-2"></i> اشتراك قارب على الانتهاء</h6>
                            <small class="text-muted" style="font-size: 0.7rem;">2 دقيقة</small>
                        </div>
                        <p class="mb-1 small text-muted">شركة الأفق للمقاولات - باقة سنوية.</p>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action bg-transparent py-3 border-bottom">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1 fw-bold text-dark small"><i class="fas fa-user-plus text-success me-2"></i> موظف جديد تم إضافته</h6>
                            <small class="text-muted" style="font-size: 0.7rem;">1 ساعة</small>
                        </div>
                        <p class="mb-1 small text-muted">تم إضافة "محمد أحمد" لشركة البناء الحديث.</p>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action bg-transparent py-3">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1 fw-bold text-dark small"><i class="fas fa-server text-info me-2"></i> نسخة احتياطية مكتملة</h6>
                            <small class="text-muted" style="font-size: 0.7rem;">أمس</small>
                        </div>
                        <p class="mb-1 small text-muted">تم حفظ بيانات النظام بنجاح.</p>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Company Modal (Same as before but ensures full functionality) -->
<div class="modal fade" id="addCompanyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4">
            <div class="modal-header bg-dark text-white border-0 px-4 py-3">
                <h5 class="modal-title fw-bold"><i class="fas fa-building text-gold me-2"></i> @(isRtl ? "إضافة شركة جديدة" : "Add New Company")</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <form>
                    <div class="mb-3">
                        <label class="form-label fw-bold small text-muted">@(isRtl ? "اسم الشركة" : "Company Name")</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0 text-gold"><i class="fas fa-signature"></i></span>
                            <input type="text" class="form-control bg-light border-start-0" placeholder="e.g. Nabd Altamayyuz">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold small text-muted">@(isRtl ? "رقم السجل التجاري" : "Registration Number")</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0 text-gold"><i class="fas fa-id-card"></i></span>
                            <input type="text" class="form-control bg-light border-start-0" placeholder="1010xxxxxx">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold small text-muted">@(isRtl ? "بريد المدير" : "Admin Email")</label>
                            <input type="email" class="form-control bg-light" placeholder="manager@company.com">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-bold small text-muted">@(isRtl ? "كلمة المرور" : "Password")</label>
                            <input type="text" class="form-control bg-light" value="123456" readonly>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0 px-4 pb-4">
                <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">@(isRtl ? "إلغاء" : "Cancel")</button>
                <button type="button" class="btn btn-gold bg-dark text-gold fw-bold rounded-pill px-4 shadow-sm hover-scale">
                    <i class="fas fa-save me-2"></i> @(isRtl ? "حفظ البيانات" : "Save Data")
                </button>
            </div>
        </div>
    </div>
</div>